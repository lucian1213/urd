<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì‘ê°€ì˜ ë§ - ë£¨ì‹œì•ˆ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family:'Noto Serif KR', serif;
      background:#000; color:#fff; padding:15px;
      min-height:100vh; overflow-x:hidden;
    }

    .container {
      max-width:600px; margin:0 auto; padding:30px 15px;
      animation:fadeIn 1.5s ease-in-out forwards;
    }
    .container.animation-done { animation:none; }

    @keyframes fadeIn {
      from { opacity:0; transform:translateY(30px); }
      to   { opacity:1; transform:translateY(0); }
    }

    .title {
      font-size:1.6rem; font-weight:600; text-align:center;
      margin-bottom:2.5rem; color:#fff; letter-spacing:1px;
    }

    .content {
      font-size:1rem; font-weight:400; margin-bottom:2.5rem;
      text-align:justify; color:#e8e8e8; line-height:1.7;
    }
    .content p { margin-bottom:0.3rem; }

    .author-name { color:#ccc; font-weight:500; margin-bottom:0; }
    .section-break { margin-top:1.5rem; }

    .input-section {
      margin:2.5rem 0; background:rgba(20,20,20,0.8);
      padding:1.5rem; border-radius:12px; border:1px solid #333;
      transition:opacity .8s ease-out, background .3s ease, border-color .3s ease;
    }

    .input-group { margin-bottom:1.2rem; }
    .input-group label {
      display:block; font-size:.9rem; font-weight:500; margin-bottom:.6rem; color:#fff;
    }
    .input-group input {
      width:100%; padding:.8rem; background:#1a1a1a; border:2px solid #333; border-radius:6px; color:#fff;
      font-family:'Noto Serif KR', serif; font-size:14px; transition:border-color .3s ease;
    }
    .input-group input:focus { outline:none; border-color:#666; background:#222; }
    .input-group input::placeholder { color:#777; }

    .textarea-group { margin-bottom:1rem; }
    .textarea-group label {
      display:block; font-size:.9rem; font-weight:500; margin-bottom:.6rem; color:#fff;
    }
    .textarea-group textarea {
      width:100%; min-height:120px; padding:.8rem; background:#1a1a1a;
      border:2px solid #333; border-radius:6px; color:#fff; font-family:'Noto Serif KR', serif;
      font-size:14px; resize:vertical; line-height:1.5; transition:border-color .3s ease;
    }
    .textarea-group textarea:focus { outline:none; border-color:#666; background:#222; }
    .textarea-group textarea::placeholder { color:#777; }

    .small-text {
      font-size:.75rem; color:#999; text-align:center; margin-bottom:1.5rem; font-style:italic;
    }

    .final-button {
      display:block; width:100%; max-width:280px; margin:2.5rem auto 0; padding:1rem 1.5rem;
      background:linear-gradient(135deg,#2a2a2a 0%,#1a1a1a 100%); border:2px solid #444; color:#fff;
      font-family:'Noto Serif KR', serif; font-size:1rem; font-weight:500; border-radius:8px;
      cursor:pointer; transition:all .3s ease; text-decoration:none; text-align:center;
    }
    .final-button:hover { background:linear-gradient(135deg,#3a3a3a 0%,#2a2a2a 100%); border-color:#666; transform:translateY(-2px); box-shadow:0 5px 15px rgba(255,255,255,.1); }
    .final-button:active { transform:translateY(0); }

    /* ì—°ì¶œ ê³µìš© */
    .fade-out { opacity:0 !important; transition:opacity .8s ease; }
    .fade-out-fast { opacity:0 !important; transition:opacity .6s ease; }

    .typing-area { margin-top:2rem; text-align:center; font-family:'Noto Serif KR', serif; }
    .typing-text { font-size:1.3rem; color:#e8e8e8; font-weight:500; min-height:2rem; transition:color .3s ease; }

    .glitching {
      color:#ff4444 !important;
      animation:textGlitch .1s infinite;
    }
    @keyframes textGlitch {
      0%   { transform:translate(0);      text-shadow:2px 0 #f00, -2px 0 #0f0; }
      25%  { transform:translate(-1px,1px); text-shadow:-2px 0 #f00, 2px 0 #0f0; }
      50%  { transform:translate(1px,-1px); text-shadow:2px 0 #00f, -2px 0 #f00; }
      75%  { transform:translate(-1px,-1px); text-shadow:-2px 0 #0f0, 2px 0 #00f; }
      100% { transform:translate(1px,1px); text-shadow:2px 0 #f00, -2px 0 #0f0; }
    }

    .screen-shake { animation:screenShake .15s infinite; }
    @keyframes screenShake {
      0% { transform:translate(0,0) rotate(0deg); }
      25% { transform:translate(2px,2px) rotate(.5deg); }
      50% { transform:translate(-1px,1px) rotate(-.5deg); }
      75% { transform:translate(1px,-2px) rotate(.5deg); }
      100% { transform:translate(-2px,-1px) rotate(-.5deg); }
    }

    .green-message { font-size:1.5rem; font-weight:600; color:#4CAF50; margin-top:2rem; line-height:1.6; text-align:center; }

    .first-char-only { color:#ff0; font-weight:bold; font-size:1.1em; text-shadow:0 0 5px #ff0; }
    .fade-out-text { transition:opacity 1s ease-out; }
    .fade-out-paragraph { transition:opacity 1s ease-out; opacity:0; }

    .final-message {
      font-size:1.6rem; font-weight:700; color:#4CAF50; letter-spacing:1px;
      text-shadow:0 0 12px #4CAF50; text-align:center; animation:finalGlow 2s ease-in-out infinite;
    }
    @keyframes finalGlow {
      0%,100% { text-shadow:0 0 10px #4CAF50; transform:scale(1); }
      50%     { text-shadow:0 0 20px #4CAF50, 0 0 30px #4CAF50; transform:scale(1.05); }
    }

    /* ì¤‘ì•™ ì¬ë“±ì¥ ë ˆì´ì–´ */
    .center-stage {
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      z-index:999; background:transparent; animation:fadeIn .8s ease;
      padding:20px; flex-direction:column;
    }

    /* ì‘ì›ê¸€ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .cheer-display {
      text-align:center; opacity:0; transform:translateY(20px);
      transition:all 0.8s ease; margin-top:50px;
    }
    .cheer-display.show { opacity:1; transform:translateY(0); }
    .cheer-content { font-size:1.8rem; font-weight:600; margin-bottom:15px; line-height:1.4; color:#fff; }
    .cheer-author { font-size:1rem; color:rgba(255,255,255,0.7); font-style:italic; }

    /* ëœë¤ ì‘ì›ê¸€ (ì „ì—­ .contentì™€ ì¶©ëŒ í”¼í•˜ë ¤ê³  í´ë˜ìŠ¤ ë¶„ë¦¬) */
    .random-cheer {
      position:fixed; z-index:998; pointer-events:none;
      opacity:0; transform:scale(0.8); transition:all 0.5s ease;
      text-align:center; max-width:300px; padding:10px;
    }
    .random-cheer.show { opacity:1; transform:scale(1); }
    .random-cheer .r-content { 
      font-size:1rem; font-weight:500; color:rgba(255,255,255,0.9); 
      margin-bottom:5px; line-height:1.3;
    }
    .random-cheer .r-author { 
      font-size:0.8rem; color:rgba(255,255,255,0.6); 
      font-style:italic; 
    }

    /* ì™„ë£Œ/ì •ë‹µ/ì—í•„ë¡œê·¸ ì˜ì—­ */
    .completion-container {
      position:fixed; inset:0; background:#000; z-index:1000;
      overflow-y:auto; padding:20px;
      animation:fadeIn 1s ease;
    }
    .completion-content { 
      text-align:left; max-width:600px; margin:0 auto; color:#fff; 
      font-family:'Noto Serif KR', serif; line-height:1.6;
      padding-bottom:2rem;
    }
    .completion-text { font-size:0.75rem; margin-bottom:3rem; }
    .completion-text p { margin-bottom:0.5rem; }

    .card-input-section {
      text-align:center; margin-top:2rem; 
      padding:2rem; background:rgba(20,20,20,0.8); 
      border-radius:12px; border:1px solid #333;
    }
    .input-instruction { font-size:1rem; margin-bottom:1rem; color:#fff; font-weight:500; }
    .card-input-section input {
      width:200px; padding:0.8rem; background:#1a1a1a; 
      border:2px solid #333; border-radius:6px; color:#fff;
      font-family:'Noto Serif KR', serif; font-size:14px; 
      text-align:center; margin-bottom:1rem;
    }
    .card-input-section input:focus { outline:none; border-color:#666; background:#222; }
    .card-input-section button {
      display:block; margin:1rem auto 0; padding:0.8rem 2rem;
      background:linear-gradient(135deg,#2a2a2a 0%,#1a1a1a 100%); 
      border:2px solid #444; color:#fff; font-family:'Noto Serif KR', serif; 
      font-size:1rem; border-radius:8px; cursor:pointer; transition:all .3s ease;
    }
    .card-input-section button:hover { 
      background:linear-gradient(135deg,#3a3a3a 0%,#2a2a2a 100%); 
      border-color:#666; transform:translateY(-2px); 
    }

    .correct-ending-container {
      position:fixed; inset:0; background:#000; z-index:1000;
      display:flex; align-items:center; justify-content:center; padding:20px;
      animation:fadeIn 1s ease;
    }
    .correct-ending-content { text-align:center; max-width:600px; color:#fff; font-family:'Noto Serif KR', serif; line-height:1.6; }
    .correct-ending-text { font-size:1.1rem; margin-bottom:3rem; }
    .correct-ending-text p { margin-bottom:1rem; }
    .epilogue-button-section { text-align:center; margin-top:2rem; }
    .epilogue-button-section button {
      padding:1rem 2.5rem; background:linear-gradient(135deg,#2a2a2a 0%,#1a1a1a 100%); 
      border:2px solid #444; color:#fff; font-family:'Noto Serif KR', serif; 
      font-size:1.1rem; border-radius:8px; cursor:pointer; transition:all .3s ease;
    }
    .epilogue-button-section button:hover { 
      background:linear-gradient(135deg,#3a3a3a 0%,#2a2a2a 100%); 
      border-color:#666; transform:translateY(-2px); 
    }

    .epilogue-container {
      position:fixed; inset:0; background:#000; z-index:1000;
      overflow-y:auto; padding:20px; animation:fadeIn 1s ease;
    }
    .epilogue-content { text-align:left; max-width:700px; margin:0 auto; color:#fff; font-family:'Noto Serif KR', serif; line-height:1.7; padding-bottom:2rem; }
    .epilogue-text { font-size:0.95rem; }
    .epilogue-text p { margin-bottom:0.8rem; }

    /* ê²Œì„ ì¢…ë£Œ í˜ì´ì§€ */
    .game-end-container {
      position:fixed; inset:0; background:#000; z-index:1000;
      display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .game-end-content { text-align:center; animation:fadeIn 2s ease-in-out; }
    .end-message { color:#fff; }
    .end-main-text { font-size:1.4rem; font-weight:500; margin-bottom:2rem; color:#e8e8e8; line-height:1.6; }
    .end-thanks { font-size:1.1rem; font-weight:400; margin-bottom:3rem; color:#ccc; }
    .author-signature { margin-bottom:3rem; font-style:italic; color:#aaa; font-size:1rem; }
    .the-end { font-size:1.8rem; font-weight:600; color:#fff; letter-spacing:3px; margin-top:2rem; }

    /* ëª¨ë°”ì¼ */
    @media (max-width:768px){
      .content { font-size:.9rem !important; line-height:1.6 !important; }
      .title { font-size:1.4rem; }
      .container { padding:20px 10px; }
      .input-section { padding:1.2rem; margin:2rem 0; }
      .typing-text { font-size:1.1rem; }
      .green-message { font-size:1.3rem; }
      .end-main-text { font-size:1.2rem; }
      .end-thanks { font-size:1rem; }
      .cheer-content { font-size:1.4rem; }
      .cheer-author { font-size:0.9rem; }
      .epilogue-content { max-width:100%; }
      .epilogue-text { font-size:0.85rem; line-height:1.6; }
    }
    @media (max-width:480px){
      .content { font-size:.85rem !important; line-height:1.5 !important; }
      .title { font-size:1.3rem; letter-spacing:.5px; }
      .input-section { padding:1rem; }
      .typing-text { font-size:1rem; }
      .green-message { font-size:1.2rem; }
      .cheer-content { font-size:1.2rem; }
      .cheer-author { font-size:0.8rem; }
    }

    ::-webkit-scrollbar { width:6px; }
    ::-webkit-scrollbar-track { background:#1a1a1a; }
    ::-webkit-scrollbar-thumb { background:#444; border-radius:3px; }
    ::-webkit-scrollbar-thumb:hover { background:#666; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">ì‘ê°€ì˜ ë§</h1>

    <div class="content">
      <p class="author-name">ì•„...ì•ˆë…•í•˜ì„¸ìš”. ì‘ê°€ ë£¨ì‹œì•ˆì…ë‹ˆë‹¤. í•œë¶„ í•œë¶„</p>
      <p>ì§ì ‘ ëµ™ê³  ì¸ì‚¬ë“œë¦¬ê³  ì‹¶ì§€ë§Œ ê·¸ëŸ´ ìˆ˜ ì—†ì–´ ì•„ì‰½ìŠµë‹ˆë‹¤.</p>

      <p class="section-break">ê²Œì„ì€ ì–´ë– ì…¨ë‚˜ìš”? ë§Œì¡±í• ë§Œí•œ ê²°ë§ì´ì—ˆë‚˜ìš”? ê°ìì˜</p>
      <p>ì„ë¬´ëŠ” ì–´ë–»ê²Œ ëŠê»´ì§€ì…¨ë‚˜ìš”? ê°ìê°€</p>
      <p>ì€ë°€í•˜ê²Œ ì›€ì§ì˜€ì–´ì•¼ í–ˆì„í…ë° ì–´ë– ì…¨ëŠ”ì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤.</p>

      <p class="section-break">ëë‚˜ê³  ë‚˜ì„œ ê²°ë§ì´ ë§˜ì— ì•ˆë“œì‹œëŠ” ë¶„ë“¤ë„ ìˆì„ê±°ì—ìš”.</p>
      <p>ë‚˜ì˜€ì–´ë„ ê·¸ë ‡ê²Œ ìƒê°í• ê±°ì—ìš”. ìš´ëª…ì€ ì •í•´ì§„ê±°ë¼ë‹ˆ...</p>
      <p>ì§€ê¸ˆë„ ì „ ìš´ëª…ì€ ì •í•´ì ¸ ìˆë‹¤ê³  ìƒê°í•´ìš”. ê·¸ë ‡ì§€</p>
      <p>ì•Šë‹¤ë©´, ì„¸ìƒì€ ë„ˆë¬´ ë¶ˆí™•ì‹¤í•˜ë‹ˆê¹Œìš”. ì‹«ì—ˆë˜ ìˆœê°„, ì¢‹</p>
      <p>ì•˜ë˜ ìˆœê°„ ëª¨ë‘ ë‹¹ì‹ ì˜ ìš´ëª…ì´ì—ìš”.</p>
      <p>ì–´ë–¤ ì˜ë¯¸ë“  ëª¨ë“  ìˆœê°„ì´ ì†Œì¤‘í–ˆì„ ê±°ë¼ê³  ìƒê°í•´ìš”.</p>

      <p class="section-break last-paragraph">ì§€ê¸ˆ ì´ ì‹œê°„ì—ë„ ìš´ëª…ì„ ë°”ê¾¸ê¸° ìœ„í•´ ë…¸ë ¥í•˜ëŠ” ë‹¤ë¥¸ ì´ì§„ìš±, ê¹€ê¸°íƒœ, ê³ ìœ¤ì •, ì´íƒœì„±ì´ ìˆì„ê±°ì—ìš”. ê·¸ë“¤ì—ê²Œ ì§„ì‹¬ ì–´ë¦° ì‘ì›ì„ ë‚¨ê²¨ë³¼ê¹Œìš”? ë‹¤ë¥¸ ì´ë“¤ì—ê²Œ í˜ì´ ë ì§€ë„...?</p>
    </div>

    <div class="input-section" id="inputSection">
      <div class="input-group">
        <label for="nickname">ë‹‰ë„¤ì„</label>
        <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" maxlength="20">
      </div>

      <div class="textarea-group">
        <label for="message">ì‘ì›ê¸€</label>
        <textarea id="message" placeholder="ì§„ì‹¬ ì–´ë¦° ì‘ì›ì˜ ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."></textarea>
      </div>

      <p class="small-text">(ì•„ì§ë„ ìš´ëª…ì„ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´, ì§„ì‹¬ì„ ë‹¤í•´ ì‘ì›ê¸€ì„ ì ì–´ì£¼ì„¸ìš”.)</p>
    </div>

    <button class="final-button" id="finalButton">ë§ˆì§€ë§‰ í˜ì´ì§€</button>
  </div>

  <!-- Firebase & Logic -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import {
      getFirestore, collection, addDoc, query, orderBy, limit, getDocs, serverTimestamp, getCountFromServer
    } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCLzzo1F4H7-d-LhrbxsDzULJG86r2vKZU",
      authDomain: "cheer-b2471.firebaseapp.com",
      projectId: "cheer-b2471",
      storageBucket: "cheer-b2471.firebasestorage.app",
      messagingSenderId: "403286093961",
      appId: "1:403286093961:web:8613cf197b75c1e3579658"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    class CheerMessageDB {
      constructor() { this.collectionName = 'cheerMessages'; }

      async saveMessage(nickname, message) {
        const newMessage = {
          nickname: nickname.trim() || 'ìµëª…',
          message: message.trim(),
          timestamp: serverTimestamp(),
          createdAt: new Date().toISOString()
        };
        const docRef = await addDoc(collection(db, this.collectionName), newMessage);
        return { id: docRef.id, ...newMessage };
      }

      async getRecentMessages(count = 4) {
        const qy = query(
          collection(db, this.collectionName),
          orderBy('timestamp', 'desc'),
          limit(count)
        );
        const snap = await getDocs(qy);
        return snap.docs.map(d => ({ id: d.id, ...d.data() }));
      }

      async getAllMessages() {
        const qy = query(
          collection(db, this.collectionName),
          orderBy('timestamp', 'desc')
        );
        const snap = await getDocs(qy);
        return snap.docs.map(d => ({ id: d.id, ...d.data() }));
      }

      async countAll() {
        const snap = await getCountFromServer(collection(db, this.collectionName));
        return snap.data().count || 0;
      }

      async seedSamples(samples) {
        for (const [nick, msg] of samples) {
          await this.saveMessage(nick, msg);
          await new Promise(r => setTimeout(r, 60));
        }
      }
    }

    const cheerDB = new CheerMessageDB();

    function isEncouragementMessage(text) {
      const encouragementKeywords = [
        'í˜ë‚´','í™”ì´íŒ…','ì‘ì›','íŒŒì´íŒ…','êµ¿ëŸ­','ì¢‹ì€','ë©‹ì§„','ëŒ€ë‹¨í•œ','ìµœê³ ','ì˜í• ',
        'í•  ìˆ˜ ìˆ','í•´ë‚¼','ì„±ê³µ','ì´ê²¨','ê·¹ë³µ','ë²„í…¨','í¬ê¸°í•˜ì§€','ëê¹Œì§€','ë…¸ë ¥',
        'í¬ë§','ë¯¿ì–´','ê¿ˆ','ëª©í‘œ','ë„ì „','ìš©ê¸°','ìì‹ ê°','ì—´ì •','ê¸ì •','ë°ì€'
      ];
      return encouragementKeywords.some(k => text.includes(k)) || text.length > 10;
    }

    // ====== ë©”ì¸ íë¦„ ======
    async function goToFinalPage() {
      const nickname = document.getElementById('nickname').value.trim();
      const message  = document.getElementById('message').value.trim();

      if (!nickname) { alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); document.getElementById('nickname').focus(); return; }
      if (!message)  { alert('ì‘ì›ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.'); document.getElementById('message').focus(); return; }

      const isEncouragement = isEncouragementMessage(message);

      try {
        if (isEncouragement) {
          await cheerDB.saveMessage(nickname, message);
          startEncouragementSequence();
        } else {
          showGameEndPage();
        }
      } catch (err) {
        console.error('ì €ì¥/ë¶„ê¸° ì˜¤ë¥˜:', err);
        isEncouragement ? startEncouragementSequence() : showGameEndPage();
      }
    }

    function showGameEndPage() {
      // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ì œê±°
      document.querySelector('.completion-container')?.remove();
      document.querySelector('.correct-ending-container')?.remove();
      document.querySelector('.epilogue-container')?.remove();

      document.querySelector('.container').style.display = 'none';
      const endPageHTML = `
        <div class="game-end-container">
          <div class="game-end-content">
            <div class="end-message">
              <p class="end-main-text">ì•„ì‰½ê²Œë„ ê²Œì„ì€ ì—¬ê¸°ê¹Œì§€ì…ë‹ˆë‹¤.</p>
              <p class="end-thanks">ì¦ê²¨ì£¼ì…”ì„œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!</p>
              <div class="author-signature"><p>-ì‘ê°€ ë£¨ì‹œì•ˆ ë“œë¦¼-</p></div>
              <div class="the-end"><p>THE END.</p></div>
            </div>
          </div>
        </div>`;
      document.body.insertAdjacentHTML('beforeend', endPageHTML);
    }

    function startEncouragementSequence() {
      const container = document.querySelector('.container');
      container.classList.add('animation-done');

      const inputSection = document.getElementById('inputSection');
      const finalButton  = document.getElementById('finalButton');

      inputSection.classList.add('fade-out');
      finalButton.classList.add('fade-out');

      setTimeout(() => {
        finalButton.style.display = 'none';
        inputSection.classList.remove('fade-out');
        inputSection.style.opacity = '1';
        inputSection.style.background = 'transparent';
        inputSection.style.borderColor = 'transparent';

        inputSection.innerHTML = `
          <div class="typing-area">
            <div class="typing-text" id="typingText"></div>
          </div>`;
        startTypingAnimation();
      }, 800);
    }

    function startTypingAnimation() {
      const typingElement = document.getElementById('typingText');
      const text = "ì•„ì‰½ê²Œë„ ê²Œì„ì€ ì—¬ê¸°ê¹Œì§€";
      let i = 0;
      const t = setInterval(() => {
        typingElement.textContent = text.slice(0, i + 1);
        i++;
        if (i >= text.length) { clearInterval(t); setTimeout(startGlitchPhase, 1000); }
      }, 100);
    }

    function startGlitchPhase() {
      const typingElement = document.getElementById('typingText');
      const container = document.querySelector('.container');

      typingElement.classList.add('glitching');
      container.classList.add('screen-shake');

      setTimeout(() => {
        typingElement.classList.remove('glitching');
        container.classList.remove('screen-shake');
        typingElement.style.display = 'none';
        startGreenMessage();
      }, 3000);
    }

    function startGreenMessage() {
      const mount = document.getElementById('inputSection');
      mount.querySelector('.typing-area')
        .insertAdjacentHTML('beforeend','<div class="green-message" id="greenMessage"></div>');

      const greenElement = document.getElementById('greenMessage');
      const text = "ì•„ì§ í¬ê¸° í•˜ì§€ë§ˆ. ìš´ëª…ì€ ë°”ê¿€ ìˆ˜ ìˆì–´.";
      let i = 0;
      const t = setInterval(() => {
        greenElement.textContent = text.slice(0, i + 1);
        i++;
        if (i >= text.length) { clearInterval(t); setTimeout(startCharacterExtraction, 800); }
      }, 80);
    }

    function startCharacterExtraction() {
      const contentParagraphs = document.querySelectorAll('.content p');
      const lastParagraph = document.querySelector('.last-paragraph');
      if (lastParagraph) lastParagraph.classList.add('fade-out-paragraph');

      let idx = 0;
      const step = setInterval(() => {
        if (idx < contentParagraphs.length) {
          const p = contentParagraphs[idx];
          const firstChar = (p.textContent || '').charAt(0) || '';
          const rest = (p.textContent || '').slice(1);

          p.innerHTML = `
            <span class="first-char-only">${firstChar}</span>
            <span class="fade-out-text">${rest}</span>`;
          setTimeout(() => {
            const fade = p.querySelector('.fade-out-text');
            if (fade) fade.classList.add('fade-out');
          }, 80);

          idx++;
        } else {
          clearInterval(step);
          setTimeout(fadeOutToBlankAndShowFinal, 900);
        }
      }, 480);
    }

    function fadeOutToBlankAndShowFinal() {
      const firstChars = document.querySelectorAll('.first-char-only');
      const green = document.getElementById('greenMessage');

      firstChars.forEach(el => el.classList.add('fade-out-fast'));
      if (green) green.classList.add('fade-out-fast');

      setTimeout(() => {
        const title = document.querySelector('.title');
        const content = document.querySelector('.content');
        const inputSection = document.getElementById('inputSection');

        if (title) { title.classList.add('fade-out-fast'); setTimeout(()=> title.style.display='none', 600); }
        if (content){ content.classList.add('fade-out-fast'); setTimeout(()=> content.style.display='none',600); }
        if (inputSection){ inputSection.classList.add('fade-out-fast'); setTimeout(()=> inputSection.style.display='none',600); }

        setTimeout(() => {
          const center = document.createElement('div');
          center.className = 'center-stage';
          center.innerHTML = `<div class="final-message">ì•„ì§ ê²Œì„ì€ ëë‚˜ì§€ ì•Šì•˜ì–´.</div>`;
          document.body.appendChild(center);

          setTimeout(() => { showCheerMessages(center); }, 2000);
        }, 650);
      }, 620);
    }

    async function showCheerMessages(centerElement) {
      let recentMessages = [];
      try {
        recentMessages = await cheerDB.getRecentMessages(4);
      } catch (e) {
        console.warn('ì‘ì›ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }

      const finalMessage = centerElement.querySelector('.final-message');

      if (!recentMessages || recentMessages.length === 0) {
        if (finalMessage) {
          finalMessage.style.opacity = '0';
          setTimeout(() => {
            finalMessage.innerHTML = 'ì²« ë²ˆì§¸ ì‘ì› ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!';
            finalMessage.style.opacity = '1';
          }, 500);
        }
        return;
      }

      if (finalMessage) finalMessage.style.opacity = '0';

      setTimeout(() => {
        if (finalMessage) finalMessage.remove();
        showMessagesSequentially(centerElement, recentMessages, 0);
      }, 500);
    }

    function showMessagesSequentially(container, messages, index) {
      if (index >= messages.length) {
        setTimeout(() => {
          const lastDisplay = container.querySelector('.cheer-display');
          if (lastDisplay) {
            lastDisplay.classList.remove('show');
            setTimeout(() => {
              lastDisplay.remove();
              startRandomCheerAnimation(messages);
            }, 800);
          } else {
            startRandomCheerAnimation(messages);
          }
        }, 2000);
        return;
      }

      const data = messages[index] || {};
      const text = (data.message || '').toString();
      const nick = (data.nickname || 'ìµëª…').toString();

      const existingDisplay = container.querySelector('.cheer-display');
      if (existingDisplay) {
        existingDisplay.classList.remove('show');
        setTimeout(() => {
          existingDisplay.remove();
          createAndShowMessage();
        }, 800);
      } else {
        createAndShowMessage();
      }

      function createAndShowMessage() {
        const cheerDisplay = document.createElement('div');
        cheerDisplay.className = 'cheer-display';
        cheerDisplay.innerHTML = `
          <div class="cheer-content">"${text}"</div>
          <div class="cheer-author">- ${nick} -</div>`;
        container.appendChild(cheerDisplay);
        setTimeout(() => { cheerDisplay.classList.add('show'); }, 100);
        setTimeout(() => { showMessagesSequentially(container, messages, index + 1); }, 2000);
      }
    }

    async function startRandomCheerAnimation(displayedMessages) {
      try {
        const allMessages = await cheerDB.getAllMessages();
        const displayedIds = new Set(displayedMessages.map(m => m.id));
        const remaining = allMessages.filter(m => !displayedIds.has(m.id));
        shuffleInPlace(remaining);
        const messagesToShow = remaining.slice(0, Math.min(20, remaining.length));

        if (messagesToShow.length === 0) {
          showCompletionMessage();
          return;
        }

        let i = 0;
        const showInterval = setInterval(() => {
          if (i >= messagesToShow.length) {
            clearInterval(showInterval);
            setTimeout(showCompletionMessage, 3000);
            return;
          }
          showRandomCheer(messagesToShow[i]);
          i++;
        }, 500);
      } catch (error) {
        console.error('ëœë¤ ì‘ì›ê¸€ í‘œì‹œ ì˜¤ë¥˜:', error);
        showCompletionMessage();
      }
    }

    function showCompletionMessage() {
      const completionDiv = document.createElement('div');
      completionDiv.className = 'completion-container';
      completionDiv.innerHTML = `
        <div class="completion-content">
          <div class="completion-text">
            <p>ì•Œì•˜ì–´. ì•Œì•˜ì–´. ê·¸ë§Œ í•´ë„ ì¢‹ì•„.</p>
            <br>
            <p>ì•„ê¹Œë¶€í„° ëˆ„ê°€ ë§í•˜ëŠ”ê±°ëƒê³ ? ìŒ... ë­ë¼ê³  í•´ì•¼í• ê¹Œ.<br>
            ë‚˜ë¡œ ë§í•  ê±° ê°™ìœ¼ë©´... ì¸ê°„ë“¤ì´ í”íˆ ë§í•˜ëŠ” ì‹ ì´ë¼ëŠ”<br>
            ì¡´ì¬ ì¼ìˆ˜ë„ ìˆê³ , ì§€ê¸ˆ ë„ˆí¬ì˜ ì´ì•¼ê¸°ì¸ 'ìš´ëª…ì˜ ì„¸ì—¬ì‹ 'ì˜<br>
            ì—¬ì‹ ì¼ ìˆ˜ë„ ìˆê³ , 'ì‘ê°€'ë¼ê³  ë§í•˜ëŠ” ì¡´ì¬ì¼ìˆ˜ë„ ìˆì–´.</p>
            <br>
            <p>ì´ ì´ì•¼ê¸°ëŠ” ë‚˜ì˜ ëœ»ëŒ€ë¡œ ì •í•´ì ¸ ìˆì–´. ë„ˆí¬ê°€ ì•„ë¬´ë¦¬<br>
            ë°”ê¾¸ë ¤ê³  í•œë“¤, ë°”ê¿€ ìˆ˜ ì—†ë‹¤ëŠ” ì´ì•¼ê¸°ì•¼. ìš´ëª…ì´ë€ê±´<br>
            ê·¸ëŸ°ê±°ì•¼. ì•„ë¬´ë¦¬ ë°œë²„ë‘¥ì³ë„ ë°”ê¿€ ìˆ˜ ì—†ëŠ” ê²ƒ.</p>
            <br>
            <p>ë…¸ë ¥í•˜ë©´ ë­ë“ ì§€ ë˜ëŠ” ê±° ì•„ë‹ˆì—ˆëƒê³ ? ê·¸ëŸ°ê±°...ë„ˆí¬ë“¤ì´<br>
            ë§Œë“  í—ˆìƒì— ë¶ˆê³¼í•´. ë  ì‚¬ëŒì€ ë…¸ë ¥í•˜ì§€ ì•Šì•„ë„ ë˜ê³ ,<br>
            ì•ˆë  ì‚¬ëŒì€ ì•„ë¬´ë¦¬ ë…¸ë ¥í•´ë„ ì•ˆë˜ëŠ” ê±°, ê·¸ê²Œ ì´ ì„¸ìƒì´ì•¼.</p>
            <br>
            <p>...ë„ˆë¬´ í•œê±° ì•„ë‹ˆëƒê³ ? ì¢‹ì•„. ê·¸ë˜ ë§ì•„. ë‚´ê°€ ì§€ê¸ˆ êµ³ì´ ë‚˜íƒ€ë‚˜ì§€<br>
            ì•Šì•„ë„ ë˜ëŠ”ë° ë‚˜íƒ€ë‚œê±´, ê·¸ë˜ì„œ ë„ˆí¬ì™€ ì´ì•¼ê¸°í•˜ê³  ìˆëŠ” ê±´<br>
            ì•„ë§ˆ ë„ˆí¬, ê·¸ë¦¬ê³  ìˆ˜ë§ì€ ë‹¤ë¥¸ ì´ì§„ìš±, ê¹€ê¸°íƒœ, ê³ ìœ¤ì •, ì´íƒœì„±ì˜<br>
            ì˜ì§€ê°€ ëª¨ì˜€ê¸° ë•Œë¬¸ì¼ê±°ì•¼. ì•„ë§ˆ ì´ ì´ì•¼ê¸°ì˜ ì—”ë”©ì„ ë³´ê³  ê·¸ëƒ¥<br>
            ëëƒˆë˜ ì‚¬ëŒë“¤, í˜¹ì€ ê·¸ ì˜ì§€ë¥¼ ë‹´ì•„ ì§„ì‹¬ì–´ë¦° ì‘ì›ì„ ë³´ë‚´ì§€<br>
            ì•Šì•˜ë˜ ì‚¬ëŒë“¤ì€ ì•„ë§ˆ ì§€ê¸ˆ ë‚˜ì™€ ì´ì•¼ê¸°í•˜ì§€ ëª»í•˜ê³  ìˆì„ ê±°ì•¼.<br>
            ê·¸ë§Œí¼ ë„ˆí¬ê°€ ìš´ëª…ì„ ë°”ê¾¸ê³ ì í•˜ëŠ” ì˜ì§€ê°€ í¬ë‹¤ëŠ” ê±°ê² ì§€.</p>
            <br>
            <p>ê·¸ëŸ° ë„ˆí¬ì—ê²Œ ìš´ëª…ì„ ë°”ê¿€ ë§ˆì§€ë§‰ ê¸°íšŒë¥¼ ì¤„ê²Œ. ì§€ê¸ˆ ë„ˆí¬ê°€<br>
            ê°€ì§€ê³  ìˆëŠ” ê²ƒ, ê·¸ëŸ¬ë‹ˆê¹Œ ì¹´ë“œì¤‘ì— í•˜ë‚˜ë¥¼ ì´ ì´ì•¼ê¸°ì—ì„œ ì—†ì•¨<br>
            ê¸°íšŒë¥¼ ì¤„ê²Œ. ë„ˆí¬ê°€ ì˜¬ë°”ë¥¸ ì„ íƒì„ í•œë‹¤ë©´, ì›í•˜ëŠ”ëŒ€ë¡œ ìš´ëª…ì„<br>
            ë°”ê¿€ ìˆ˜ ìˆì„ê±°ì•¼.</p>
            <br>
            <p>ëª…ì‹¬í•´. ê¸°íšŒëŠ” í•œë²ˆ ë¿ì´ì•¼. ì˜ ìƒê°í•´ì„œ íŒë‹¨í•˜ë¼êµ¬.</p>
          </div>
          <div class="card-input-section">
            <p class="input-instruction">ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input type="text" id="cardNumber"
                   placeholder="ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                   maxlength="10" inputmode="numeric"
                   autocomplete="off" autocapitalize="off">
            <button id="submitCard">í™•ì¸</button>
          </div>
        </div>
      `;
      document.body.appendChild(completionDiv);

      // ğŸ”’ ì˜¤ë²„ë ˆì´ ë„ìš´ ì§í›„ í™”ë©´ì„ ë§¨ ìœ„ë¡œ ê³ ì • (ëª¨ë°”ì¼ í‚¤ë³´ë“œ ìë™ ë„ì›€ ë°©ì§€)
      requestAnimationFrame(() => {
        window.scrollTo({ top: 0, left: 0, behavior: 'auto' });
        completionDiv.scrollTop = 0;
      });

      // ì´ë²¤íŠ¸ ë°”ì¸ë”©
      const submitBtn = completionDiv.querySelector('#submitCard');
      const cardInput = completionDiv.querySelector('#cardNumber');

      submitBtn.addEventListener('click', submitCardNumber);
      cardInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') submitCardNumber();
      });

      // âŒ ìë™ focus ê¸ˆì§€ (ì»¤ì„œê°€ ê°€ì§€ ì•Šë„ë¡)
      // cardInput.focus();
    }

    function submitCardNumber() {
      const field = document.getElementById('cardNumber');
      const cardNumber = (field?.value || '').trim();
      if (!cardNumber) {
        alert('ì¹´ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        // ìë™ í¬ì»¤ìŠ¤ëŠ” í•˜ì§€ ì•ŠìŒ
        return;
      }
      if (cardNumber === '10') {
        showCorrectEnding();
      } else {
        // ì˜¤ë²„ë ˆì´ ì œê±° í›„ ì¼ë°˜ ì—”ë”©
        document.querySelector('.completion-container')?.remove();
        showGameEndPage();
      }
    }

    function showCorrectEnding() {
      document.querySelector('.completion-container')?.remove();

      const correctDiv = document.createElement('div');
      correctDiv.className = 'correct-ending-container';
      correctDiv.innerHTML = `
        <div class="correct-ending-content">
          <div class="correct-ending-text">
            <p>ê·¸ê±¸ë¡œ ê´œì°®ì€ê±´ê°€. ë„ˆí¬ì˜ ì„ íƒì´ ì–´ë–¤ ê²°ê³¼ë¡œ ì´ì–´ì§ˆê¹Œ.</p>
            <p>ì´ì œ ë‚˜ì™€ì˜ ëŒ€í™”ëŠ” ì—¬ê¸°ì„œ ëì´ì•¼. ë¶€ë”” ì›í•˜ëŠ” ëŒ€ë¡œ ê²°ê³¼ê°€ ì´ë£¨ì–´ì§€ê¸¸ ë°”ë˜.</p>
            <p>ê·¸ëŸ¼ ì•ˆë…•.</p>
          </div>
          <div class="epilogue-button-section">
            <button id="epilogueBtn">ì—í•„ë¡œê·¸ ë³´ê¸°</button>
          </div>
        </div>
      `;
      document.body.appendChild(correctDiv);

      correctDiv.querySelector('#epilogueBtn').addEventListener('click', showEpilogue);
    }

    function showEpilogue() {
      document.querySelector('.correct-ending-container')?.remove();

      const epilogueDiv = document.createElement('div');
      epilogueDiv.className = 'epilogue-container';
      epilogueDiv.innerHTML = `
        <div class="epilogue-content">
          <div class="epilogue-text">
            <p>"ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ! ì˜¤ëŠ˜ë¶€ë¡œ ê°•ë ¥ 3íŒ€ìœ¼ë¡œ ì „ì…ì„ ëª… ë°›ì€ ì´ìœ ì •ì…ë‹ˆë‹¤!"</p>
            <p>ëª¨ì²˜ëŸ¼ ì¡°ìš©í–ˆë˜ ê°•ë ¥ 3íŒ€ì´ ê°‘ìê¸° ì†Œë€ìŠ¤ëŸ¬ì›Œì§„ë‹¤. ìì‹ ì˜ ìë¦¬ì—ì„œ ì¡¸ë‹¤ê°€ ê¹œì§ ë†€ë¼ ì ì—ì„œ ê¹¬ ì´ì§„ìš± í˜•ì‚¬ëŠ” ì§œì¦ ì„ì¸ ë§íˆ¬ë¡œ ë§í•œë‹¤.</p>
            <p>"ì•„ì´ì”¨, ê¹œì§ì´ì•¼. ëˆ„ê°€ ì´ë ‡ê²Œ ì‹œë„ëŸ½ê²Œ ì¸ì‚¬ë¥¼â€¦"</p>
            <p>ì‹œë„ëŸ¬ìš´ ì¸ì‚¬ì˜ ì£¼ì¸ê³µì—ê²Œ ê³ ê°œë¥¼ ëŒë¦° ì´ì§„ìš±ì€ í™”ë¥¼ ë‚´ë ¤ë‹¤ ìˆœê°„ í ì¹«í•œë‹¤.</p>
            <p>ë†€ëê²Œë„ ê³¼ê±° ìì‹ ì´ ì†Œì¤‘íˆ ì—¬ê²¼ë˜ ë™ë£Œì˜ ëª¨ìŠµì´, ê·¸ë…€ì—ê²Œ ì–´ë ´í’‹ì´ ë³´ì˜€ê¸° ë•Œë¬¸ì´ë‹¤.</p>
            <p>"ì„ ë°°ë‹˜! ë§ì”€ ë§ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤! ê°•ë ¥ 3íŒ€ì˜ ë¶ˆë„ì €! ì•ìœ¼ë¡œ ì„ ë°°ë‹˜ê»˜ ë§ì´ ë°°ìš°ê² ìŠµë‹ˆë‹¤!"</p>
            <p>"í â€¦ ë„ˆ ì´ë¦„ì´ ë­ë¼ê³ ?"</p>
            <p>"ì´ìœ ì •ì…ë‹ˆë‹¤! ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤!"</p>
            <p>"ì•„ì˜¤ ì‹œë„ëŸ¬ì›Œ. ì•ìœ¼ë¡œ ë‚´ ì•ì—ì„  ëª©ì†Œë¦¬ ë‚®ì¶°. ì•Œê² ë‚˜?"</p>
            <p>"ë„¤! ëª…ì‹¬í•˜ê² ìŠµë‹ˆë‹¤!"</p>
            <p>ë³´ë€ ë“¯ì´ ë”ìš±ë” í˜ì°¨ê²Œ ëŒ€ë‹µí•œ ê·¸ë…€ëŠ”, ì´ì§„ìš±ì„ í–¥í•´ ì›ƒì–´ ë³´ì¸ë‹¤.</p>
            <p>ì´ì§„ìš±ì€ ê·¸ëŸ° ê·¸ë…€ë¥¼ ë³´ë©° ë– ì˜¬ë¦¬ê³  ì‹¶ì§€ ì•Šì•˜ë˜, ê³¼ê±°ì˜ ì¼ë“¤ì´ ë– ì˜¤ë¥¸ë‹¤.</p>
            <p>ì£„ì±…ê° ë•Œë¬¸ì¼ê¹Œ. ê·¸ë…€ì—ê² ì™ ì§€ ëª¨ë¥¼ ë¯¸ì•ˆí•¨ì´ ëŠê»´ì§„ë‹¤.</p>
            <br><p style="text-align:center;">. . . . . .</p><br>
            <p>"ì„ ë°°ë‹˜! ë˜ ì£¼ë¬´ì‹­ë‹ˆê¹Œ!"</p>
            <p>ê¹œì§ ë†€ë¼ ì ì—ì„œ ê¹¬ ì´ì§„ìš± í˜•ì‚¬ëŠ” ì–´ì•ˆì´ ë²™ë²™í•œ ë“¯ ì£¼ë³€ì„ ë‘˜ëŸ¬ë³¸ë‹¤.</p>
            <p>ëª©ì†Œë¦¬ë¥¼ ë”°ë¼ ê³ ê°œë¥¼ ëŒë ¤ë³´ë‹ˆ, ì´ìœ ì • í˜•ì‚¬ê°€ ìì‹ ì„ ë³´ë©° ì›ƒê³  ìˆë‹¤.</p>
            <p>"ì„ ë°°ë‹˜! ë­ ì•ˆ ì¢‹ì€ ê¿ˆì´ë¼ë„ ê¾¸ì…¨ë‚˜ ë´…ë‹ˆë‹¤. í•˜í•«."</p>
            <p>ì•ˆ ì¢‹ì€ ê¿ˆì´ë¼â€¦ ì˜ ê¸°ì–µì€ ì•ˆ ë‚˜ì§€ë§Œ ì–´ë”˜ê°€ ë©€ë¦¬, ê¸´ ì‹œê°„ ë™ì•ˆ ë‹¤ë…€ì˜¨ ê¸°ë¶„ì´ë‹¤.</p>
            <p>ì •ì‹ ì„ ì°¨ë¦¬ê³  ì£¼ë³€ì„ ë‘˜ëŸ¬ë³´ë‹ˆ, ê°•ë ¥ 3íŒ€ ìì‹ ì˜ ìë¦¬ë‹¤. ê·¸ë˜, ë§¤ì¼ ë³´ë˜ ê·¸ ìµìˆ™í•œ í’ê²½. í•˜ì§€ë§Œ ì™œ ì¸ì§€ ëª¨ë¥´ê²Œ ë‚¯ì„¤ê²Œ ëŠê»´ì§„ë‹¤.</p>
            <p>"2022ë…„ 12ì›” 13ì¼, ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ì…ë‹ˆë‹¤."</p>
            <p>TVì—ì„œ ë‰´ìŠ¤ê°€ ë‚˜ì˜¤ê³  ìˆë‹¤. ë­”ê°€ ì¤‘ìš”í•œ ë‚ ì´ì—ˆë˜ ê²ƒ ê°™ì€ ê¸°ë¶„ì´ ë“ ë‹¤.</p>
            <p>í•˜ì§€ë§Œ ê·¸ê²ƒì— ëŒ€í•´ ìƒê°í• ìˆ˜ë¡ ë¨¸ë¦¬ê°€ ê¹¨ì§ˆ ë“¯ì´ ì•„íŒŒì§„ë‹¤. ê·¸ë•Œ ì˜†ì— ìˆë˜ ì´ìœ ì • í˜•ì‚¬ê°€ ëˆ„êµ°ê°€ì—ê²Œ ì¸ì‚¬ë¥¼ í•œë‹¤.</p>
            <p>"ì„œì¥ë‹˜! ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ!"</p>
            <p>ì„œì¥? ì´ìœ ì •ì´ ì¸ì‚¬ë¥¼ í•œ ë°©í–¥ìœ¼ë¡œ ì‹œì„ ì„ ëŒë ¤ë³´ë‹ˆ, ë‚¯ìµì€ ëª¨ìŠµì˜ ë‚¨ìê°€ ë‚˜ì—ê²Œ ì¸ì‚¬ë¥¼ í•´ì˜¨ë‹¤.</p>
            <p>"ì•¼, ì§„ìš±ì•„. ì„œì¥ì´ ì™”ìœ¼ë©´ ì¸ì‚¬ëŠ” ëª»í• ë§ì • ë°˜ê°€ìš´ ì²™ì´ë¼ë„ í•´ì•¼ í•˜ëŠ” ê±° ì•„ë‹ˆëƒâ€¦?"</p>
            <p>ê·¸ë ‡ë‹¤. ë‚´ ì¹œêµ¬. ê²½ì°°ì„œì¥ì´ì—ˆì§€â€¦ì§€ê¸ˆê¹Œì§€ ì­‰ ê·¸ë˜ì™”ì„ í…ë°. ì´ì§„ìš± í˜•ì‚¬ëŠ” ì´ ìƒí™©ì´ ë¬´ì–¸ê°€ ì–´ìƒ‰í•˜ê³  ë‚¯ì„¤ë‹¤. ê·¸ë•Œ ì–´ë”˜ê°€ì—ì„œ ë“¤ë ¤ì˜¤ëŠ” ì „í™” ë²¨ ì†Œë¦¬.</p>
            <p>"ì§„ìš±ì•„, ì „í™” ì˜¤ì–ì•„. ì˜¤ëŠ˜ ì¢€ ì´ìƒí•˜ë„¤â€¦ ì ì´ ëœ ê¹¼ë‚˜?"</p>
            <p>ì£¼ë¨¸ë‹ˆì—ì„œ íœ´ëŒ€í°ì„ êº¼ë‚´ í™”ë©´ì„ ë³´ë‹ˆ 'ì•„ë“¤'ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œë¶€í„° ì „í™”ê°€ ì˜¤ê³  ìˆë‹¤.</p>
            <p>ì•„ë“¤? ë‚˜í•œí…Œ ì•„ë“¤ì´ ìˆì—ˆë‚˜? ë¯¸ì‹¬ì©ì€ ê¸°ë¶„ìœ¼ë¡œ ì „í™”ë¥¼ ë°›ëŠ”ë‹¤.</p>
            <p>"ì—¬ë³´ì„¸ìš”. ì•„ë¹ ! ì˜¤ëŠ˜ ë¬´ìŠ¨ ë‚ ì¸ì§€ ì•Œì§€? ì¼ì° ë“¤ì–´ì˜¤ê¸°ë¡œ í–ˆì–ì•„!"</p>
            <p>"â€¦ ì˜¤ëŠ˜ì´ ë¬´ìŠ¨ ë‚  ì¸ë°?"</p>
            <p>"ì•„ë¹ .. ëª‡ ë²ˆì´ë‚˜ ì–˜ê¸°í–ˆëŠ”ë°. ë˜ ìŠì–´ë²„ë ¸ì–´? ë‚´ ìƒì¼ì´ì–ì•„â€¦ê¸°ëŒ€í•œ ë‚´ê°€ ì˜ëª»ì´ë‹¤!"</p>
            <p>ê·¸ëŸ¬ê³ ëŠ”, ìˆ˜í™”ê¸° ë„ˆë¨¸ë¡œ ì–´ë–¤ ì—¬ì„±ì˜ ëª©ì†Œë¦¬ê°€ ë“¤ë ¤ì˜¨ë‹¤.</p>
            <p>"ì–´íœ´, ì—„ë§ˆ ë°”ê¿”ì¤˜ ë´. ì—¬ë³´! ì˜¤ëŠ˜ì€ ì¼ì° ë“¤ì–´ì™€! í˜„ì¥ ë°”ìœ ê±° ë‚˜ë„ ê²ªì–´ë´ì„œ ë‹¤ ì•Œì§€ë§Œ, ì˜¤ëŠ˜ ê°™ì€ ë‚ ì€ ê·¸ë˜ë„ ì¼ì° ì™€! ì¤€ë¹„í•˜ê³  ê¸°ë‹¤ë¦¬ê³  ìˆì„ í…Œë‹ˆê¹Œ."</p>
            <p>"ê³ â€¦ ìœ¤ì •â€¦?"</p>
            <p>"ê·¸ë˜. ì™œ, ì´ì œ ë§ˆëˆ„ë¼ ì´ë¦„ê¹Œì§€ ê¹Œë¨¹ì—ˆì–´? ì—¬íŠ¼ ë¹¨ë¦¬ ì™€! ê¸°íƒœí•œí…Œë„ ì–˜ê¸°í–ˆìœ¼ë‹ˆê¹Œ ê¸°íƒœë‘ ê°™ì´ ì™€. ëŠëŠ”ë‹¤!"</p>
            <p>ëŠì–´ì§„ ì „í™”ë¥¼ ë³´ë©°, ì´ì§„ìš± í˜•ì‚¬ëŠ” ì™ ì§€ ëª¨ë¥¼ ì•ˆë„ê°ê³¼ í•¨ê»˜ ê¸°ì¨ì˜ ê°ì •ì´ ì†Ÿêµ¬ì³ ì˜¤ë¥¸ë‹¤.</p>
            <p>ë§ˆì¹˜, ê·¸ ë‘ ì‚¬ëŒì´ ë°©ê¸ˆ ì „ê¹Œì§€ëŠ” ì—†ì—ˆë˜ ì‚¬ëŒì¸ ê²ƒì²˜ëŸ¼ ëŠê»´ì§„ë‹¤. ê·¸ë•Œ ê°‘ìê¸° í•œ ë‚¨ì„±ì´ ê°•ë ¥ 3íŒ€ì˜ ë¬¸ì„ ë°•ì°¨ê³  ë“¤ì–´ì˜¤ë©° ì†Œë¦¬ì¹œë‹¤.</p>
            <p>"ì„ ë°°ë‹˜ë“¤! ì¶œë™ì´ìš” ì¶œë™! ì‚´ì¸ì‚¬ê±´ì´ëë‹ˆë‹¤!"</p>
            <p>ë°•ì •ìš°ì˜€ë‹¤. ê°•ë ¥ 3íŒ€ì˜ 6ê°œì›” ì°¨ ì‹ ì…ì´ì ë§‰ë‚´. ì—­ì‹œë‚˜ ê·¸ì—ê²Œë„ í‰ì†Œì™€ëŠ” ë‹¤ë¥¸ ë¬´ì–¸ê°€ê°€ ëŠê»´ì§€ëŠ” ì´ì§„ìš± í˜•ì‚¬ëŠ”, ê·¸ë¥¼ ë³´ë©° ë©í•˜ë‹ˆ ìƒê°ì— ì ê¸´ë‹¤.</p>
            <p>"ì„ ë°°ë‹˜. ì¤€ë¹„ ì•ˆ í•˜ì„¸ìš”? ì¶œë™ì´ë¼ì–ì•„ìš”!"</p>
            <p>ë¯¸ë™ë„ ì—†ì´ ê·¸ì˜ ìë¦¬ì— ì•‰ì•„ìˆëŠ” ì´ì§„ìš± í˜•ì‚¬ë¥¼ ë³´ë©°, ì´ìœ ì • í˜•ì‚¬ê°€ ì†Œë¦¬ì¹œë‹¤.</p>
            <p>"ì–´.. ì–´. ê·¸ë˜ ì•Œì•˜ì–´."</p>
            <p>ê·¸ì œì•¼ ì •ì‹ ì„ ì°¨ë¦° ë“¯ ì„œë‘˜ëŸ¬ ì¥ë¹„ë¥¼ ì±™ê¸°ëŠ” ì´ì§„ìš± í˜•ì‚¬. ëª¨ë‘ê°€ ì¶œë™í•˜ê³  í…… ë¹ˆ ê°•ë ¥ 3íŒ€ì—ëŠ” í‹€ì–´ ë†“ì€ TVì†Œë¦¬ë§Œì´ ê·¸ ê³µê°„ì„ ì±„ìš°ê³  ìˆë‹¤.</p>
            <p>"ë‹¤ìŒ ë‰´ìŠ¤ì…ë‹ˆë‹¤. ì„¸ê³„ì ìœ¼ë¡œ ê·¸ ì¬ëŠ¥ì„ ì¸ì •ë°›ê³  ìˆëŠ” ê³¼í•™ì ë°•ì§€ìš° ì”¨ê°€, ì¤‘ëŒ€ë°œí‘œë¥¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤. ê³¼í•™ìì˜€ë˜ ì•„ë²„ì§€ì˜ ë’¤ë¥¼ ì´ì–´, JHì—°êµ¬ì†Œì˜ ì†Œì¥ì´ ëœ ê·¸ëŠ” ì„¸ê³„ë¥¼ ê¹œì§ ë†€ë¼ê²Œ í•  ë§Œí•œ ì—°êµ¬ì— ì„±ê³µí–ˆë‹¤ê³  í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ 15ì‹œì— ì˜ˆì •ë˜ì–´ ìˆëŠ” ê¸°ìíšŒê²¬ì€â€¦"</p>
            <br><p style="text-align:center;">. . . . . .</p><br>
            <p style="text-align:center; font-size:1.2rem; font-weight:600;">THE END.</p>
            <br>
            <p style="text-align:center; color:#ccc;">ì‘ê°€ : ë£¨ì‹œì•ˆ</p>
            <p style="text-align:center; color:#ccc;">ë””ìì´ë„ˆ : ë§µì”¨</p>
            <p style="text-align:center; color:#ccc;">ì œì‘ : ë¯¸ìŠ¤í„°ë¦¬ê²Œì„ì¦ˆ</p>
          </div>
        </div>
      `;
      document.body.appendChild(epilogueDiv);
    }

    function showRandomCheer(message) {
      const randomDiv = document.createElement('div');
      randomDiv.className = 'random-cheer';

      const x = Math.random() * (window.innerWidth - 320) + 10;
      const y = Math.random() * (window.innerHeight - 100) + 10;
      randomDiv.style.left = x + 'px';
      randomDiv.style.top  = y + 'px';

      randomDiv.innerHTML = `
        <div class="r-content">"${message.message}"</div>
        <div class="r-author">- ${message.nickname} -</div>
      `;
      document.body.appendChild(randomDiv);

      setTimeout(() => { randomDiv.classList.add('show'); }, 60);
      setTimeout(() => {
        randomDiv.classList.remove('show');
        setTimeout(() => randomDiv.remove(), 450);
      }, 1500);
    }

    function shuffleInPlace(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // ====== ì´ˆê¸° ì‹œë“œ(ìµœì†Œ 24ê°œ ë³´ì¥) & ì´ˆê¸° í¬ì»¤ìŠ¤ ======
    window.addEventListener('load', async () => {
      try {
        const MIN = 24;
        const cur = await cheerDB.countAll();
        if (cur < MIN) {
          const need = MIN - cur;
          const sampleMessages = [
            ['ì‘ì›ë‹¨ì¥', 'í˜ë‚´ì„¸ìš”! í•­ìƒ ì‘ì›í•˜ê³  ìˆì–´ìš”!'],
            ['ì—´ì •ë§¨', 'í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”! ëê¹Œì§€ í™”ì´íŒ…!'],
            ['í¬ë§ì´', 'ë‹¹ì‹ ì€ ì¶©ë¶„íˆ ì˜í•˜ê³  ìˆì–´ìš”!'],
            ['ìš©ê¸°ìŒ¤', 'ì–´ë ¤ìš´ ì‹œê¸°ì§€ë§Œ ë°˜ë“œì‹œ ê·¹ë³µí•  ê±°ì˜ˆìš”!'],
            ['ê¸ì •ì™•', 'ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!'],
            ['ë“œë¦¼ìºì²˜', 'ê¿ˆì„ í–¥í•´ ë‹¬ë ¤ê°€ì„¸ìš”!'],
            ['íŒŒì›Œì—…', 'ë‹¹ì‹ ì˜ ì ì¬ë ¥ì„ ë¯¿ì–´ìš”!'],
            ['ì„ ìƒ¤ì¸', 'ë°ì€ ë¯¸ë˜ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”!'],
            ['ìŠ¤íŠ¸ë¡±', 'ì–´ë–¤ ì–´ë ¤ì›€ë„ ì´ê²¨ë‚¼ ìˆ˜ ìˆì–´ìš”!'],
            ['í•´í”¼', 'í–‰ë³µí•œ ìˆœê°„ë“¤ì´ ê°€ë“í•˜ê¸¸!'],
            ['ë¸Œë ˆì´ë¸Œ', 'ìš©ê°í•˜ê²Œ ë„ì „í•˜ì„¸ìš”!'],
            ['ìŠ¤ë§ˆì¼', 'ì›ƒìŒ ìƒì§€ ë§ˆì„¸ìš”!'],
            ['ìœ„ë„ˆ', 'ë‹¹ì‹ ì€ ì´ë¯¸ ìŠ¹ë¦¬ìì˜ˆìš”!'],
            ['ì—ë„ˆì§€', 'ê¸ì • ì—ë„ˆì§€ ê°€ë“ ë³´ë‚´ë“œë ¤ìš”!'],
            ['ë³„ë¹›', 'ì–´ë‘  ì†ì—ì„œë„ ë¹›ë‚˜ëŠ” ë³„ì²˜ëŸ¼!'],
            ['ë°”ëŒ', 'ìˆœí’ì´ ë¶ˆì–´ì£¼ê¸¸ ë°”ë¼ìš”!'],
            ['ë¬´ì§€ê°œ', 'ë¹„ ì˜¨ ë’¤ ë¬´ì§€ê°œê°€ ëœ° ê±°ì˜ˆìš”!'],
            ['ë‚˜ì¹¨ë°˜', 'ì˜¬ë°”ë¥¸ ê¸¸ë¡œ ì¸ë„í•´ë“œë¦´ê²Œìš”!'],
            ['ë´„ë‚ ', 'ë”°ëœ»í•œ ë´„ë‚ ì´ ì˜¬ ê±°ì˜ˆìš”!'],
            ['ë‚ ê°œ', 'ë†’ì´ ë‚ ì•„ì˜¤ë¥´ì„¸ìš”!'],
            ['ë“±ëŒ€', 'ê¸¸ì„ ìƒì§€ ì•Šë„ë¡ ì‘ì›í•´ìš”!'],
            ['ë³´ì„', 'ë‹¹ì‹ ì€ ì†Œì¤‘í•œ ë³´ì„ ê°™ì€ ì¡´ì¬!'],
            ['íƒœì–‘', 'ë°ê²Œ ë¹›ë‚˜ëŠ” íƒœì–‘ì²˜ëŸ¼!'],
            ['ë‹¬ë¹›', 'ê³ ìš”í•œ ë°¤ì—ë„ ë¹›ì„ ìƒì§€ ë§ˆì„¸ìš”!'],
            ['í•˜íŠ¸', 'ì§„ì‹¬ ì–´ë¦° ë§ˆìŒìœ¼ë¡œ ì‘ì›í•©ë‹ˆë‹¤!']
          ];
          await cheerDB.seedSamples(sampleMessages.slice(0, need));
          console.log(`[seed] ìƒ˜í”Œ ${need}ê°œ ì£¼ì… ì™„ë£Œ`);
        }
      } catch (e) {
        console.warn('[seed] ì‹¤íŒ¨:', e);
      }
      document.getElementById('nickname')?.focus();
    });

    // ====== ì •ì  ìš”ì†Œ ì´ë²¤íŠ¸ ë°”ì¸ë”© ======
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('finalButton')?.addEventListener('click', goToFinalPage);
      document.getElementById('nickname')?.addEventListener('keypress', e => {
        if (e.key === 'Enter') document.getElementById('message')?.focus();
      });
    });
  </script>
</body>
</html>

